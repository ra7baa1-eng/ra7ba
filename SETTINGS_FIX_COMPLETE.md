# ุฅุตูุงุญ ูุดููุฉ ุฅุนุฏุงุฏุงุช ุงููุชุฌุฑ - ุฏููู ุดุงูู

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

ุชู ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุชุทุจูู ุงูุชุบููุฑุงุช ูู ุฅุนุฏุงุฏุงุช ุงููุชุฌุฑ ุจุดูู ูุงูู ูุน ุฅุถุงูุฉ ูุฒุงููุฉ ููุฑูุฉ ุจุงุณุชุฎุฏุงู Supabase Realtime.

---

## โ ุงูุชุบููุฑุงุช ูู Backend

### 1. ุชุญุฏูุซ `UpdateStoreSettingsDto`
**ุงูููู:** `backend/src/modules/merchant/dto/update-store-settings.dto.ts`

ุชูุช ุฅุถุงูุฉ ุงูุญููู ุงูุชุงููุฉ:
- `privacyPolicy` - ุณูุงุณุฉ ุงูุฎุตูุตูุฉ
- `termsOfService` - ุดุฑูุท ุงูุฎุฏูุฉ
- `returnPolicy` - ุณูุงุณุฉ ุงูุฅุฑุฌุงุน
- `thankYouMessage` - ุฑุณุงูุฉ ุตูุญุฉ ุงูุดูุฑ
- `thankYouImage` - ุตูุฑุฉ ุตูุญุฉ ุงูุดูุฑ

### 2. ุชุญุฏูุซ `MerchantService.updateStoreSettings()`
**ุงูููู:** `backend/src/modules/merchant/merchant.service.ts`

**ุงูุชุญุณููุงุช:**
- โ ุฅุถุงูุฉ console.log ููุชุชุจุน ูุงูุชุตุญูุญ
- โ ุชุญุฏูุซ ุฌููุน ุงูุญููู ุจุดูู ุตุฑูุญ ูู `prisma.update()`
- โ ุงูุชุฃูุฏ ูู ุญูุธ ุฌููุน ุงูููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฅุฑุฌุงุน ุงููุงุฆู ุงููุญุฏุซ ูุจุงุดุฑุฉ

```typescript
console.log('๐ Updating store settings for tenant:', tenantId);
console.log('๐ฆ Data received:', JSON.stringify(data, null, 2));

const updated = await this.prisma.tenant.update({
  where: { id: tenantId },
  data: {
    name: data.name,
    nameAr: data.nameAr,
    description: data.description,
    // ... ุฌููุน ุงูุญููู ุงูุฃุฎุฑู
  },
});

console.log('โ Store updated successfully:', updated.id);
return updated;
```

### 3. Controller ุฌุงูุฒ
**ุงูููู:** `backend/src/modules/merchant/merchant.controller.ts`

ุงูู endpoint ููุฌูุฏ ูุณุจูุงู:
```typescript
@Patch('merchant/store/settings')
async updateStoreSettings(@CurrentUser() user: any, @Body() data: UpdateStoreSettingsDto)
```

---

## ๐จ ุงูุชุบููุฑุงุช ูู Frontend

### 1. ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุฌุฏูุฏุฉ
**ุงูููู:** `frontend/src/app/merchant/settings/page.tsx`

**ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:**
- โ ุงุณุชุฎุฏุงู `merchantApi` ุจุฏูุงู ูู axios ุงููุจุงุดุฑ
- โ ุฑูุน ุงููููุงุช (logo/banner) ุนุจุฑ `uploadImageToImgBB` ุฃููุงู
- โ ุฅุฑุณุงู URLs ููุท ุฅูู Backend
- โ ุชุญุฏูุซ ุงููุงุฌูุฉ ููุฑุงู ุจุนุฏ ุงูุญูุธ
- โ ุฑุณุงุฆู ูุฌุงุญ/ุฎุทุฃ ูุงุถุญุฉ ูุน `toast`
- โ ูุฒุงููุฉ ููุฑูุฉ ูุน Supabase Realtime

**ุงูุฃูุณุงู ุงููุชููุฑุฉ:**
1. **ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ** - ุงุณู ุงููุชุฌุฑุ ุงููุตูุ ุงูุดุนุงุฑุ ุงูุบูุงูุ ุงููุงุชูุ ุงูุนููุงู
2. **ุงูุณูุงุณุงุช ูุงูุดุฑูุท** - ุณูุงุณุฉ ุงูุฎุตูุตูุฉุ ุดุฑูุท ุงูุฎุฏูุฉุ ุณูุงุณุฉ ุงูุฅุฑุฌุงุน
3. **ุงูุฅุดุนุงุฑุงุช** - Telegram Chat ID
4. **ุงูููุฒุงุช** - (ูุงุจู ููุชูุณุน)

### 2. ููุชุจุฉ Supabase ูููุฒุงููุฉ ุงูููุฑูุฉ
**ุงูููู:** `frontend/src/lib/supabase.ts`

```typescript
export function subscribeToTable(
  table: string,
  callback: (payload: any) => void,
  filter?: { column: string; value: any }
)
```

**ุงููุธุงุฆู:**
- ุงูุงุดุชุฑุงู ูู ุชุญุฏูุซุงุช ุฌุฏูู ูุนูู
- ุชุตููุฉ ุงูุชุญุฏูุซุงุช ุญุณุจ tenant ID
- ุฅูุบุงุก ุงูุงุดุชุฑุงู ุนูุฏ ุฅูุบุงุก ุชุญููู ุงููููู

### 3. Hook ูุฎุตุต ูููุฒุงููุฉ
**ุงูููู:** `frontend/src/hooks/useRealtimeStore.ts`

```typescript
export function useRealtimeStore(tenantId: string | null) {
  const [storeData, setStoreData] = useState<any>(null);
  const [isConnected, setIsConnected] = useState(false);
  // ...
}
```

**ุงูููุฒุงุช:**
- ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงูุจูุงูุงุช ูู Supabase
- ูุคุดุฑ ุญุงูุฉ ุงูุงุชุตุงู
- ุชูุธูู ุงูุงุดุชุฑุงูุงุช ุชููุงุฆูุงู

---

## ๐ง ุฎุทูุงุช ุงูุชุซุจูุช

### 1. ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ

```bash
cd frontend
npm install @supabase/supabase-js
```

### 2. ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

ุฃุถู ูู `frontend/.env.local`:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 3. ุชูุนูู Realtime ูู Supabase

ูู ุจุชุดุบูู SQL ุงูุชุงูู ูู Supabase SQL Editor:

```sql
-- ุชูููู Realtime ูุฌุฏูู Tenant
ALTER TABLE "Tenant" REPLICA IDENTITY FULL;

-- ุฅุถุงูุฉ ุณูุงุณุงุช ุงูุฃูุงู (RLS)
CREATE POLICY "Tenants can view their own data"
  ON "Tenant" FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Tenants can update their own data"
  ON "Tenant" FOR UPDATE
  USING (auth.uid() = id);
```

### 4. ุชุดุบูู ุงููุดุฑูุน

```bash
# Backend
cd backend
npm run start:dev

# Frontend
cd frontend
npm run dev
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุชุบููุฑุงุช

### 1. ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุงูุดุนุงุฑ
1. ุงูุชุญ ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช
2. ุงุถุบุท ุนูู "ุฑูุน ุดุนุงุฑ"
3. ุงุฎุชุฑ ุตูุฑุฉ
4. ุชุฃูุฏ ูู:
   - โ ุฑูุน ุงูุตูุฑุฉ ุจูุฌุงุญ
   - โ ุธููุฑ ุงูุดุนุงุฑ ุงูุฌุฏูุฏ ููุฑุงู
   - โ ุญูุธ URL ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุงูุณูุงุณุงุช
1. ุงูุชูู ุฅูู ุชุจููุจ "ุงูุณูุงุณุงุช ูุงูุดุฑูุท"
2. ุฃุฏุฎู ูุต ุณูุงุณุฉ ุงูุฎุตูุตูุฉ
3. ุงุถุบุท "ุญูุธ ุงูุณูุงุณุงุช"
4. ุชุฃูุฏ ูู:
   - โ ุธููุฑ ุฑุณุงูุฉ ูุฌุงุญ
   - โ ุญูุธ ุงููุต ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - โ ุจูุงุก ุงููุต ุจุนุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ

### 3. ุงุฎุชุจุงุฑ ุงููุฒุงููุฉ ุงูููุฑูุฉ
1. ุงูุชุญ ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ูู ูุชุตูุญูู ูุฎุชูููู
2. ูู ุจุชุบููุฑ ุฃู ุฅุนุฏุงุฏ ูู ุงููุชุตูุญ ุงูุฃูู
3. ุชุฃูุฏ ูู:
   - โ ุธููุฑ ูุคุดุฑ "ูุชุตู - ูุฒุงููุฉ ููุฑูุฉ"
   - โ ุชุญุฏูุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู ูู ุงููุชุตูุญ ุงูุซุงูู
   - โ ุธููุฑ ุฑุณุงูุฉ "ุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู! ๐"

### 4. ุงุฎุชุจุงุฑ ุนุฒู ุงูุจูุงูุงุช (Tenant Isolation)
1. ุณุฌู ุฏุฎูู ุจุญุณุงุจูู ูุฎุชูููู (tenant1, tenant2)
2. ูู ุจุชุบููุฑ ุฅุนุฏุงุฏุงุช tenant1
3. ุชุฃูุฏ ูู:
   - โ ุนุฏู ุชุฃุซุฑ ุฅุนุฏุงุฏุงุช tenant2
   - โ ูู ูุชุฌุฑ ูุฑู ุจูุงูุงุชู ููุท

---

## ๐ ุณุฌู ุงูุชุญุฏูุซุงุช (Logs)

ุนูุฏ ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุชุ ุณุชุธูุฑ ุงูุณุฌูุงุช ุงูุชุงููุฉ ูู Backend:

```
๐ Updating store settings for tenant: clxxxxx...
๐ฆ Data received: {
  "name": "ูุชุฌุฑ ุชุฌุฑูุจู",
  "logo": "https://...",
  ...
}
โ Store updated successfully: clxxxxx...
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุชุบููุฑุงุช ูุง ุชุญูุธ
**ุงูุญู:**
1. ุชุญูู ูู console.log ูู Backend
2. ุชุฃูุฏ ูู ูุฌูุฏ tenantId ุตุญูุญ
3. ุชุญูู ูู ุตูุงุญูุงุช JWT token

### ุงููุดููุฉ: ุงููุฒุงููุฉ ุงูููุฑูุฉ ูุง ุชุนูู
**ุงูุญู:**
1. ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ (SUPABASE_URL, SUPABASE_ANON_KEY)
2. ุชุฃูุฏ ูู ุชูุนูู Realtime ูู Supabase
3. ุชุญูู ูู ุณูุงุณุงุช RLS

### ุงููุดููุฉ: ุฑูุน ุงูุตูุฑ ููุดู
**ุงูุญู:**
1. ุชุญูู ูู `/storage/upload` endpoint
2. ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููุชุงุจุฉ ูู Supabase Storage
3. ุชุญูู ูู ุญุฌู ุงูุตูุฑุฉ (max 5MB)

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃูุงู:**
   - ุฌููุน ุงูุชุญุฏูุซุงุช ุชุชุทูุจ JWT token ุตุญูุญ
   - ูู tenant ููููู ุชุนุฏูู ุจูุงูุงุชู ููุท
   - ุณูุงุณุงุช RLS ููุนูุฉ ูู Supabase

2. **ุงูุฃุฏุงุก:**
   - ุฑูุน ุงูุตูุฑ ูุชู ุฃููุงู ูุจู ุญูุธ ุงูุฅุนุฏุงุฏุงุช
   - ุงููุฒุงููุฉ ุงูููุฑูุฉ ุชุนูู ููุท ููู tenant ุงููุดุท
   - ุงูุชุญุฏูุซุงุช ุชุชู ุจุดูู ุฌุฒุฆู (patch) ูููุณ ูุงูู

3. **ุงูุชูุงูู:**
   - ุงูููู ุงููุฏูู ูุญููุธ ูู `page_old_backup.tsx`
   - ูููู ุงูุฑุฌูุน ูููุณุฎุฉ ุงููุฏููุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ **ุฌููุน ุงูุชุญุฏูุซุงุช ุชุนูู ุจูุฌุงุญ:**
- ุชุญุฏูุซ ุงูุดุนุงุฑ ูุงูุบูุงู
- ุชุญุฏูุซ ูุนูููุงุช ุงููุชุฌุฑ
- ุชุญุฏูุซ ุงูุณูุงุณุงุช ูุงูุดุฑูุท
- ุฅุดุนุงุฑุงุช Telegram
- ูุฒุงููุฉ ููุฑูุฉ ุจูู ุงููุชุตูุญุงุช
- ุนุฒู ูุงูู ุจูู ุงููุชุงุฌุฑ

โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณููุฉ:**
- ุฑุณุงุฆู ูุงุถุญุฉ ูููุฌุงุญ/ุงูุฎุทุฃ
- ูุคุดุฑ ุญุงูุฉ ุงูุงุชุตุงู
- ุชุญุฏูุซุงุช ููุฑูุฉ ุจุฏูู ุฅุนุงุฏุฉ ุชุญููู
- ูุงุฌูุฉ ูุธููุฉ ูุณููุฉ ุงูุงุณุชุฎุฏุงู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉุ ุชุญูู ูู:
1. ุณุฌูุงุช Backend (console.log)
2. ุณุฌูุงุช Frontend (browser console)
3. Supabase Dashboard (Realtime logs)
4. Network tab ูู DevTools

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 18 ุฃูุชูุจุฑ 2025
**ุงูุญุงูุฉ:** โ ููุชูู ูุฌุงูุฒ ููุฅูุชุงุฌ
